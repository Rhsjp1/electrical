<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SparkySolve AI - Hands Free</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a1a1a; font-family: sans-serif; }
        .chat-container { height: calc(100vh - 200px); }
    </style>
</head>
<body class="flex flex-col max-w-md mx-auto min-h-screen bg-zinc-900 text-zinc-100">
    <header class="bg-yellow-400 text-black p-4 shadow-lg border-b-4 border-yellow-600 text-center">
        <h1 class="text-xl font-black uppercase tracking-widest">‚ö° SparkySolve AI</h1>
        <p class="text-xs font-bold italic text-zinc-800">Tap the Mic to Speak Your Problem</p>
    </header>

    <div id="chat-box" class="chat-container overflow-y-auto p-4 space-y-4">
        <div class="bg-zinc-800 p-4 rounded-lg border-l-4 border-yellow-400">
            <p class="font-bold text-yellow-400 text-sm italic">SYSTEM: STANDBY</p>
            <p class="text-sm mt-1 uppercase font-bold">Tap mic to start voice report.</p>
        </div>
    </div>

    <div class="p-4 bg-zinc-800 border-t border-zinc-700 sticky bottom-0 shadow-2xl">
        <div class="flex flex-col gap-3">
            <div class="flex gap-2">
                <button id="mic-btn" onclick="startListening()" class="bg-red-600 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg border-2 border-red-800 active:scale-90 transition-all">
                    <span id="mic-icon" style="font-size: 24px;">üéôÔ∏è</span>
                </button>
                <textarea id="user-input" placeholder="Speak or type issue..." class="flex-1 bg-zinc-900 border border-zinc-600 rounded-lg px-4 py-3 text-white focus:ring-2 focus:ring-yellow-400 outline-none text-sm" rows="1"></textarea>
            </div>
            <button onclick="askAI()" class="bg-yellow-400 text-black py-3 rounded-lg font-black uppercase hover:bg-yellow-300 active:scale-95 transition-all">Get Solution</button>
        </div>
    </div>

    <script>
       const apiKey = process.env.NEXT_PUBLIC_GOOGLE_API_KEY;
        const input = document.getElementById('user-input');
        const micBtn = document.getElementById('mic-btn');
        const micIcon = document.getElementById('mic-icon');

        // VOICE LOGIC - Listen to the Electrician
        function startListening() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("Voice not supported on this browser. Use Chrome or Safari.");
                return;
            }
            const recognition = new SpeechRecognition();
            recognition.start();
            micBtn.classList.add('animate-pulse', 'bg-red-400');
            micIcon.innerText = "üõë";

            recognition.onresult = (event) => {
                input.value = event.results[0][0].transcript;
                micBtn.classList.remove('animate-pulse', 'bg-red-400');
                micIcon.innerText = "üéôÔ∏è";
            };

            recognition.onerror = () => {
                micBtn.classList.remove('animate-pulse', 'bg-red-400');
                micIcon.innerText = "üéôÔ∏è";
            };
        }

        async function askAI() {
            const chatBox = document.getElementById('chat-box');
            if (!input.value) return;

            const userText = input.value;
            chatBox.innerHTML += `<div class="bg-zinc-700 p-3 rounded-lg text-sm self-end ml-8 border border-zinc-500 uppercase font-mono italic">${userText}</div>`;
            
            const loadingId = Date.now();
            chatBox.innerHTML += `<div id="${loadingId}" class="text-yellow-400 text-xs animate-pulse font-bold uppercase tracking-tighter">Running Diagnostic...</div>`;
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "Expert Electrician Mode: Give a fix, parts list, and cost for: " + userText }] }]
                    })
                });

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                document.getElementById(loadingId).remove();
                chatBox.innerHTML += `<div class="bg-zinc-800 p-4 rounded-lg text-sm border-l-4 border-yellow-400 shadow-md prose prose-invert">${aiText.replace(/\n/g, '<br>')}</div>`;
            } catch (error) {
                document.getElementById(loadingId).innerText = "ERROR: SYSTEM OFFLINE";
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>
